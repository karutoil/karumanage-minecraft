{
  "meta": {
    "name": "Hytale Dedicated Server",
    "version": "latest",
    "author": "Hypixel Studios"
  },
  "compat": {
    "os": ["linux"],
    "arch": ["x86_64", "aarch64"]
  },
  "install": {
    "script": "https://raw.githubusercontent.com/karutoil/catalyst-minecraft/refs/heads/main/hytale-installer.sh",
    "dir": "/srv/game",
    "deps": ["curl", "unzip", "temurin-25-jre"]
  },
  "uninstall": {
    "script": "https://raw.githubusercontent.com/karutoil/catalyst-minecraft/refs/heads/main/hytale-uninstall.sh",
    "keepFilesSupported": true
  },
  "runtimeMode": "lxc",
  "lxc": {
    "image": "ubuntu:22.04",
    "profiles": ["default"],
    "limits": {
      "cpuShares": 4096,
      "memoryMB": 8192,
      "rootFsSizeMB": 20480
    },
    "mounts": [
      {
        "source": "{{instance_dir}}",
        "target": "/srv/game",
        "readonly": false
      }
    ],
    "network": {
      "mode": "bridge",
      "bridge": "lxcbr0",
      "nat": true
    },
    "ports": [
      {
        "hostPort": 5520,
        "containerPort": 5520,
        "protocol": "udp"
      }
    ]
  },
  "runtime": {
    "start": "cd /srv/game/AppFiles && stdbuf -oL -eL java -server -Xms1024m -Xmx6144m -XX:MaxMetaspaceSize=512M -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=compact -jar /srv/game/AppFiles/Server/HytaleServer.jar --assets /srv/game/AppFiles/Assets.zip --accept-early-plugins",
    "stop": "pkill -15 -f HytaleServer.jar",
    "restart": "pkill -15 -f HytaleServer.jar && sleep 2 && (cd /srv/game/AppFiles && stdbuf -oL -eL java -server -Xms1024m -Xmx6144m -XX:MaxMetaspaceSize=512M -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=compact -jar /srv/game/AppFiles/Server/HytaleServer.jar --assets /srv/game/AppFiles/Assets.zip --accept-early-plugins &)",
    "cwd": "/srv/game/AppFiles",
    "env": {
      "JAVA_OPTS": "-XX:MaxMetaspaceSize=512M -XX:+UnlockExperimentalVMOptions -XX:+UseShenandoahGC -XX:ShenandoahGCHeuristics=compact -XX:ShenandoahUncommitDelay=30000 -XX:ShenandoahAllocationThreshold=15 -XX:ShenandoahGuaranteedGCInterval=30000 -XX:+PerfDisableSharedMem -XX:+DisableExplicitGC -XX:+ParallelRefProcEnabled -XX:ParallelGCThreads=4 -XX:ConcGCThreads=2 -XX:+AlwaysPreTouch",
      "HEAP_MB": "6144",
      "PORT": "5520",
      "SERVER_NAME": "Hytale Server",
      "MAX_PLAYERS": "100",
      "SERVER_MOTD": ""
    },
    "process": {
      "match": "HytaleServer.jar"
    }
  },
  "metrics": {
    "cpu": {
      "method": "pid"
    },
    "memory": {
      "method": "pid"
    },
    "players": {
      "method": "log_parse",
      "file": "/srv/game/logs/latest.log",
      "regex": "\\[(.*?)\\].*Player\\s+(\\w+)\\s+joined"
    }
  },
  "logs": {
    "main": "/srv/game/logs/latest.log",
    "rotate": {
      "strategy": "size",
      "maxBytes": 52428800,
      "keep": 5
    }
  },
  "console": {
    "type": "socket",
    "socket": {
      "path": "/srv/game/console.socket",
      "protocol": "hytale-console",
      "method": "write"
    }
  },
  "files": {
    "editable": [
      {
        "path": "/srv/game/AppFiles/Server/config.json",
        "format": "json"
      }
    ]
  },
  "ports": [
    {
      "name": "game",
      "protocol": "udp",
      "port": 5520
    }
  ],
  "actions": [
    {
      "name": "Save World",
      "cmd": "save",
      "method": "socket",
      "timeout": 30
    },
    {
      "name": "Stop Server",
      "cmd": "shutdown",
      "method": "socket",
      "timeout": 15
    },
    {
      "name": "List Players",
      "cmd": "players",
      "method": "socket",
      "timeout": 5
    }
  ],
  "resources": {
    "cpu": 4,
    "memoryMB": 8192,
    "diskMB": 20480
  }
}
